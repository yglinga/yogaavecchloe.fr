define("render",["lodash","utils","core"],function(a,b,c){"use strict";var d=typeof window!=="undefined"&&window.performance&&window.performance.now?window.performance.now.bind(window.performance):Date.now.bind(Date);function e(a,b){var c=b.query;var d=c.configName||"fullFunctionality";var e=a[d]||a.fullFunctionality;var f=e.getConfig();if(!c.dsOrigin){throw new Error("You must define dsOrigin parameter in order to use the documentServices - please speak to html-server team for a key")}f.origin=c.dsOrigin;return f}function f(c,d,e){var f=a(e).keys().pull("masterPage").value();return a.mapValues(e,function(a,e){if(d&&window.pagesData&&window.pagesData[e]){return a}return b.dataFixer.fix(a,f.slice(),c.requestModel,c.currentUrl,c.urlFormatModel)})}function g(b,e,f,g,h){c.renderer.renderSite(e,f,g,function(c){if(window.rendered){window.rendered.forceUpdate()}else{var e=window.document.getElementById("SITE_CONTAINER").children[0];window.rendered=b.reactDOM.render(c,window.document.getElementById("SITE_CONTAINER"));var f=window.document.getElementById("SITE_CONTAINER").children[0];if(window.sssr){window.sssr.success=e===f;window.sssr.clientSideRender={sinceInitialTimestamp:Date.now()-window.wixBiSession.initialTimestamp,performanceNow:d()}}window.onpopstate=window.rendered.onPopState;window.onhashchange=window.rendered.onHashChange;if(window.parent){window.rendered.registerAspectToEvent("siteReady",function(){if(h){h(window.rendered)}if(window.documentServices){window.parent.postMessage("documentServicesLoaded","*")}})}if(b.qaAutomation){a.set(window,"testApi.domSelectors",b.qaAutomation.getDomSelectors(b.react,b.reactDOM));window.testApi.domSelectors.setSearchRoot(window.rendered);a.set(window,"testApi.isReady",true)}}})}function h(d,e,f){var g={};if(b.urlUtils.isQueryParamOn(f.currentUrl,"isSantaEditor")){g=a.assign(g,{componentViewMode:"editor"})}if(b.urlUtils.isQueryParamOn(f.currentUrl,"isExternalPreview")){g=a.assign(g,{isSocialInteractionAllowed:false})}f.renderFlags=a.assign({},f.renderFlags,g);var h=new b.SiteData(f);var i=c.SiteDataAPI.createSiteDataAPIAndDal(h,e);var j=i.siteData;var k=i.siteDataAPI;var l={pointers:i.pointers,displayedDAL:i.displayedDal,siteDataAPI:k};var m=false;return{fullSiteData:h,displayedSiteData:j,siteDataWrapper:i,viewerPrivateServices:l,isServerSideRender:m,siteModel:f,siteDataAPI:k}}function i(c,d,e,f){f=f||c.lodash.noop;var g=h(c,d,e);function i(){var b=a.toArray(arguments);var c=b.join("");var d=window.document.getElementById(c);if(!d){var e=b[0];var f=b.slice(1).map(function(a){return a.replace(e,"")}).join("");d=window.document.getElementById(e+f)}return d}var j=g.displayedSiteData;var k=b.wixUrlParser.parseUrl(j,j.currentUrl.full);var l=k.pageId;g.viewerPrivateServices.siteDataAPI.loadPage(k,function(){var a={inner:{structure:j.pagesData[l].structure,pageId:l,getDomNodeFunc:i},outer:{structure:j.pagesData.masterPage.structure,pageId:"masterPage",getDomNodeFunc:i}};c.layout.reLayout(a,{getSiteData:function(){return j},getAllRenderedRootIds:function(){return["masterPage",l]},getRuntimeDal:function(){return g.viewerPrivateServices.siteDataAPI.runtime}});i("masterPage").style.visibility="";i(k.pageId).style.visibility="";f(g)})}function j(a,b,c,d,e){var f=h(a,b,c);k(a,f,d,e)}function k(c,d,h,i){var j=c.documentServices;try{if(j&&a.isUndefined(window.karmaIntegration)&&window.parent.FS){b.integrations.fullStory.start()}}catch(a){}if(j){d.siteDataWrapper.dataLoadedRegistrar=d.siteDataAPI.registerDataLoadedCallback.bind(d.siteDataAPI);window.documentServices=new j.Site(e(j.configs,d.siteModel.currentUrl),d.siteDataWrapper,a.partial(f,d.siteModel,d.isServerSideRender),a.partial(g,c,d.displayedSiteData,d.viewerPrivateServices,h));a.set(window,"testApi.documentServices",window.documentServices)}else{d.fullSiteData.pagesData=d.fullSiteData.pagesData&&f(d.siteModel,d.isServerSideRender,d.fullSiteData.pagesData);g(c,d.displayedSiteData,d.viewerPrivateServices,h,i)}}return{clientSide:j,clientSideWithPrivates:k,serverSide:i,fixPages:f}});