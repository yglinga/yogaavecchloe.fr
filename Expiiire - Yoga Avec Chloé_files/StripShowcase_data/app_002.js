var StripShowcaseController=function(i){var t=this;utils.capabilities.mask(),t.resize=_.debounce(_.bind(t._resize,t),200),StripShowcaseController.super_.apply(t,arguments),t.itemClass="item",t.itemSelector="."+t.itemClass,t.items=[],t.props={},t.dimCache={},t.inactiveElementOpacity=.25,t.activeElementOpacity=0};utils.inherits(StripShowcaseController,SimpleAppProto),StripShowcaseController.prototype.getPageWidth=function(){var i=this;return Math.min(i.isMobile?320:980,i.viewportSize.width)},StripShowcaseController.prototype.itemClick=function(i,t,e,a){switch(this.props.galleryImageOnClickAction){case"zoomMode":Wix.pushState(JSON.stringify({cmd:"zoom",args:[t]})),this.autoplayPause();break;case"goToLink":this.openLink(i.href,i.target,i.linkType,a,i["data-anchor"],this.mainPageId,i.link)}return!1},StripShowcaseController.prototype.init=function(i){this.items=i.items||[],this.props=i.props||{},this.marketingLandingPage=i.marketingLandingPage,this.marketingLandingPage&&(this.inactiveElementOpacity=.5,$(this.el).addClass("marketingLandingPage")),this.props.transition="carousel",this.createDom(),this.updateLayout()},StripShowcaseController.prototype._resize=function(){this.destroy(),this.init({items:this.items,props:this.props})},StripShowcaseController.prototype.destroy=function(){try{$("#displayCycle").cycle("destroy")}catch(i){}this.el.html("")},StripShowcaseController.prototype.getSidesRatio=function(i){var t;switch(i){case"16:9":t=16/9;break;case"4:3":t=4/3;break;case"1:1":t=1;break;case"3:4":t=.75;break;case"9:16":t=9/16;break;default:t=1}return t},StripShowcaseController.prototype.dimCrop=function(i,t){var e=this.getSidesRatio(this.props.imageScale);return{height:this.containerHeight,width:Math.floor(this.containerHeight*e)}},StripShowcaseController.prototype.dimFit=function(i,t){var e=this.containerHeight/t;return{height:this.containerHeight,width:Math.floor(i*e)}},StripShowcaseController.prototype.updateLayout=function(){var i=this,t=$("#display"),e=$("#thumbnails"),a=50,o=this.getSidesRatio(this.props.thumbsScale),s=a,r=(Math.floor(a*o),i.getPageWidth()-(i.isMobile?20:2)),n=8;if(this.props.autoplayInterval=this.props.autoplayInterval?this.props.autoplayInterval:1,i.props.showThumbnails?e.width(r).height(s-2).css("padding","0 1px"):(s=0,n=0),this.el.css(_.extend({overflow:"hidden"},i.viewportSize)),this.containerWidth=i.viewportSize.width,this.containerHeight=i.viewportSize.height-s-n,!(this.containerHeight<0)){t.width(this.containerWidth).height(this.containerHeight).css({marginBottom:n-2+"px",overflow:"hidden"}),$("#displayCycle").width(this.containerWidth).height(this.containerHeight),$(".next,.prev",t).css("background-color","white").find(".inner").css("background-color","black"),$(".thumb:not(:last)","#thumbnails").css({marginRight:i.props.thumbsMargin+"px"});var l=$("#displayCycle"),h=utils.pyramid.isOverThresholdChange();if($(".item",l).each(function(){var t,e,a=i.items[$(this).attr("index")];"fit"==i.props.cropAndFitStage?(t=i.dimFit(a.width,a.height),e="contain"):(t=i.dimCrop(a.width,a.height),e="cover"),$(this).css({width:t.width,height:t.height});var o={width:t.width,height:t.height,backgroundRepeat:"no-repeat",backgroundPosition:"50%"};$(".filler",this).css(o),$(".overlay",this).css(o),h&&$(".filler",this).css({backgroundImage:"url("+utils.getResizedImageUrl(a.uri,t.width,t.height,{siteQuality:i.quality,maxWidth:a.width,maxHeight:a.height})+")",backgroundSize:e})}),i.props.showThumbnails){var d=$("#thumbnails").closest(".hoverscroll");$("#thumbnails").appendTo(d.parent()).hoverscroll({width:r,height:s+2,arrows:!1}),d.remove(),$(".overlay",e).removeClass("current").eq(i.initialSlideIndex).addClass("current")}}},StripShowcaseController.prototype.autoplayPause=function(){var i=$("#displayCycle");i.cycle("pause"),this.isPlaying=!1},StripShowcaseController.prototype.autoplayResume=function(){if("editor"!=this.editMode){var i=$("#displayCycle");this.props.autoplay&&i.cycle("resume"),this.isPlaying=this.props.autoplay}},StripShowcaseController.prototype.getViewportSize=function(){var i=(document.body,document.documentElement);return this.viewportSize={width:i.clientWidth,height:i.clientHeight},this.viewportSize},StripShowcaseController.prototype.zoomClosed=function(){this.autoplayResume()},StripShowcaseController.prototype.changeEditMode=function(){var i=$("#displayCycle");"editor"==this.editMode?this.autoplayPause():this.autoplayResume(),i.cycle({timeout:1e3*this.props.autoplayInterval})},StripShowcaseController.prototype._randomTransition=function(){var i=["fade","slide","scroll","zoom"];this._fxRandomized=this._fxRandomized||_.shuffle(i),this._fxRandomIteration=this._fxRandomIteration||0;var t=this._fxRandomIteration%this._fxRandomized.length;return this._fxRandomIteration++,this._fxFromTransition(this._fxRandomized[t])},StripShowcaseController.prototype._fxFromTransition=function(i){var t={fx:i,transition:i,speed:1e3*(this.props.transDuration||1)};switch(i){case"none":t.fxSpeed=t.speed,t.speed=1;break;case"zoom":case"crossFade":t.fx="fadeout";break;case"scroll":t.fx="scrollVert";break;case"slide":t.fx="scrollHorz";break;case"random":t.fx="random";break;case"tile":t.fx="tileBlind";break;case"slice":t.fx="tileSlice"}return t},StripShowcaseController.prototype.createDom=function(){this.getViewportSize(),this.slideMargin=this.props.imageMargin;var i=$("<div></div>").appendTo(this.el).attr("id","display"),t=$("<div></div>").appendTo(this.el).attr("id","thumbnails"),e=this,a=50,o=this.getSidesRatio(this.props.thumbsScale),s=this.getSidesRatio(this.props.imageScale),r=a,n=Math.floor(a*o),l=e.getPageWidth()-(e.isMobile?20:2),h=8;if(e.props.showThumbnails?t.width(l).height(r-2).css("padding","0 1px"):(r=0,h=0,t.remove()),this.el.css(_.extend({overflow:"hidden"},e.viewportSize)),this.thumbnailsHovered=!1,this.containerWidth=e.viewportSize.width,this.containerHeight=e.viewportSize.height-r-h,i.width(this.containerWidth).height(this.containerHeight).css({marginBottom:h-2+"px",overflow:"hidden"}),e.props.arrowMode){$('<div><div class="inner"></div></div>').appendTo(i).addClass("prev"),$('<div><div class="inner"></div></div>').appendTo(i).addClass("next")}var d=$("<div></div>").attr("id","displayCycle").appendTo(i),p=e.props.transition||"none",c=e._fxFromTransition(p);e.initialSlideIndex=e.initialSlideIndex||0,e.initialTransition=e.initialTransition||p,e.items[e.initialSlideIndex]||(e.initialSlideIndex=0),this.props.autoplayInterval=this.props.autoplayInterval?this.props.autoplayInterval:1,e.isPlaying=e.props.autoplay&&"editor"!=e.editMode;var m=this.containerHeight*s;if("fit"==e.props.cropAndFitStage&&this.items.length>0){var g=this.items[e.initialSlideIndex],u=e.dimFit(g.width,g.height);m=u.width}m+=this.slideMargin;var v=this.isMobile&&"4:3"==e.props.thumbsScale&&"editor"!=this.editMode?e.props.imageMargin:0,y=Math.floor(this.containerWidth/2-m/2+v),f="<div class='thumb' style='display:inline-block; width:{{thumbWidth}}px; height:{{thumbHeight}}px; background: url({{thumb}}) 50% no-repeat'>"+(this.marketingLandingPage?"":"<div class='overlay'></div>")+"</div>";d.attr({"data-cycle-slides":">div","data-cycle-timeout":1e3*e.props.autoplayInterval,"data-cycle-auto-height":!1,"data-cycle-paused":!e.isPlaying,"data-cycle-fx":c.fx,"data-cycle-log":!1,"data-cycle-speed":c.speed,"data-cycle-pager":"#thumbnails","data-starting-slide":e.initialSlideIndex,"data-cycle-pager-template":f,"data-cycle-prev":"#display .prev","data-cycle-next":"#display .next","data-allow-wrap":!0,"data-cycle-carousel-offset":y,"data-cycle-easing":"easeOutQuart"}).on("cycle-before",function(i,a,o,s,r){if(e.marketingLandingPage){var h=$(s);$(".cycle-slide").removeClass("active-slide-inner"),$(".cycle-slide").removeClass("init-cycle-slide"),h.addClass("active-slide-inner")}e.inTransition=!0,e.initialSlideIndex=$(s).attr("index")%e.items.length;var p=$(".overlay",t).removeClass("current").eq(e.initialSlideIndex).addClass("current"),m=$(".overlay",t).not(p),g=Math.min(150,500*e.props.autoplayInterval),u=$(s).attr("index"),v=$(o).attr("index"),y=$(o).siblings("[index="+u+"]").not(s);e.marketingLandingPage&&y.addClass("active-slide-inner");var f=$("[index="+v+"]",e.el);if($(".overlay",y).fadeTo(1.5*g+c.fxSpeed||c.speed,e.activeElementOpacity,function(){$(y).add(f).find(".overlay").fadeTo(0,e.inactiveElementOpacity)}),$(".overlay",s).add(p).fadeTo(1.5*g+c.fxSpeed||c.speed,e.activeElementOpacity),$(".overlay",o).add(m).fadeTo(g+c.fxSpeed||c.speed,e.inactiveElementOpacity),e.isPlaying||e.thumbnailsHovered===!1){var w=e.initialSlideIndex*n-Math.round(l/2-n);$(t).parent().stop().animate({scrollLeft:w},c.fxSpeed||c.speed,function(){})}var S="zoomMode"==e.props.galleryImageOnClickAction||"disabled"!=e.props.galleryImageOnClickAction&&e.items[u].href;$(e.itemSelector+" .filler, "+e.itemSelector+" .overlay",d).css({cursor:"pointer"}),$(".filler,.overlay",s).css({cursor:S?"pointer":"auto"})}).on("cycle-post-initialize",function(i){$(e.itemSelector+" .filler,"+e.itemSelector+" .overlay",d).css({cursor:"pointer"});var t="zoomMode"==e.props.galleryImageOnClickAction||"disabled"!=e.props.galleryImageOnClickAction&&e.items[e.initialSlideIndex]&&e.items[e.initialSlideIndex].href;$(".filler,.overlay",".cycle-slide-active").css({cursor:t?"pointer":"auto"});var a=$(".cycle-slide-active");$(e.itemSelector,e.el).not(a).find(".overlay").fadeTo(0,e.inactiveElementOpacity)}).on("cycle-after",function(){e.inTransition=!1}).on("cycle-bootstrap",function(i,t,a){var o=$.fn.cycle.transitions[t.fx],s=o.postInit;o.postInit=function(){var i=s.apply(this,arguments);return $(".cycle-slide-active .overlay").fadeTo(0,e.activeElementOpacity),i}}),i.on("click",e.itemSelector,function(i){var t=$(i.currentTarget),a=$(".cycle-slide-active",e.el),o=0^t.attr("index"),s=0^a.attr("index");return t.is(".cycle-slide-active")?void e.itemClick(e.items[o],o,i.target,i):void(e.inTransition||o==s||(e.inTransition=!0,d.cycle("goto",o,t.index()-a.index())))});var w='<div data-thumb="<%=thumbnail%>" data-thumb-width="<%=thumbnailWidth%>" data-thumb-height="<%=thumbnailHeight%>"><div class="filler"></div>'+(this.marketingLandingPage?"":'<div class="overlay"></div>')+"</div>",S=_.template(w);if(_.each(this.items,function(i,t){var o=i.width/i.height;Math.floor(a*o);_.extend(i,{thumbnail:utils.getResizedImageUrl(i.uri,n,a,{siteQuality:e.quality,maxWidth:i.width,maxHeight:i.height}),thumbnailWidth:n,thumbnailHeight:r});var s,l,h;if("fit"==e.props.cropAndFitStage?(s=e.dimFit(i.width,i.height),l="contain"):(s=e.dimCrop(i.width,i.height),l="cover"),h=$(S(i)).appendTo(d).css({width:s.width,height:s.height,marginRight:e.slideMargin/2+"px",marginLeft:e.slideMargin/2+"px"}).attr("index",t).addClass(e.itemClass),"random"==c.fx){var p=e._randomTransition();h.attr({"data-cycle-fx":p.fx,"data-cycle-speed":p.speed,"data-transition":p.transition})}var m=l+i.uri+e.props.imageScale,g=e.dimCache[m]||{width:s.width,height:s.height};s.height>g.height&&s.width>g.width&&(g=s),e.dimCache[m]=g,$(".filler",h).css({width:s.width+"px",height:s.height+"px",background:"url("+utils.getResizedImageUrl(i.uri,g.width,g.height,{siteQuality:e.quality,maxWidth:i.width,maxHeight:i.height})+")",backgroundRepeat:"no-repeat",backgroundPosition:"50%",backgroundSize:l}),$(".overlay",h).css({width:s.width+"px",height:s.height+"px"})}),d.cycle({}),e.props.showThumbnails&&(t.hoverscroll({width:l,height:r+2,arrows:!1}),t.hover(function(){e.thumbnailsHovered=!0,e.autoplayPause()},function(){e.thumbnailsHovered=!1,e.autoplayResume()})),i.hover(function(){i.addClass("active")},function(){i.removeClass("active")}),e.isMobile){$("html").addClass("mobile-view"),i.hammer().on("swipeleft swipeup",function(){console.log("swipe left/down",e.inTransition),e.inTransition||d.cycle("next")}).on("swiperight swipedown",function(){console.log("swipe right/up",e.inTransition),e.inTransition||d.cycle("prev")});var x=0;t.hammer().on("dragstart",function(i){x=$(".listcontainer").get(0).scrollLeft}).on("drag",function(i){var t=i.gesture,e=$(".listcontainer").get(0);return e.scrollLeft=x-t.deltaX,!1}),i.css({touchAction:"auto"})}else $("html").removeClass("mobile-view")},StripShowcaseController.prototype.updateSettings=function(i){var t=document.body.clientHeight;if(this.mainPageId=i.mainPageId,this.quality=i.quality||{},this.marketingLandingPage=i.marketingLandingPage,i.props.showThumbnails===!1&&this.props.showThumbnails===!0)return this.props=i.props,this.items=i.items,void Wix.setHeight(t-58);if(i.props.showThumbnails===!0&&this.props.showThumbnails===!1)return this.props=i.props,this.items=i.items,void Wix.setHeight(t+58);var e=["uri"],a=!1;if(this.el.attr("data-text-mode",i.props.textMode),this.el.attr("data-animation",i.props.transition),"fit"==i.props.cropAndFitStage&&(i.props.imageScale="1:1"),this.items.length!=i.items.length)a=!0;else for(var o=0;o<this.items.length;o++){if(utils.propertiesChanged(this.items[o],i.items[o],e)){a=!0;break}_.extend(this.items[o],i.items[o])}if(_.keys(utils.difference(this.props,i.props)).length&&(a=!0),this.props=i.props,a=!0,a?(this.destroy(),this.init(i)):this.resize(),self.initialTransition&&self.initialTransition!=i.props.transition){self.initialTransition=i.props.transition;var s=$("#displayCycle");setTimeout(function(){s.cycle("next")},1e3)}};